---
tags: ubuntu, gearman, bugs
title: Ubuntu 14.04 + Gearman
---

В базовой установке Gearman в ubuntu 14.04 есть баг - инит-скрипт написан не правильно и в результате Gearman  не реагирует наличие конфиг файла и запускается с настойками по умолчанию. Причем, на одном из серверов у меня проблемма после обновления усугубилась и он перестал запускаться даже с настройками по умолчанию.

Есть два варианта решения проблемы:

1.	Пропатчить инит-скрипт, как это сделать можно прочитать [здесь](http://jeremykendall.net/2014/09/04/ubuntu-14-dot-04-gearman-config-bug/)
2.	Запускать его из под supervisord.

У меня все приложения крутятся под supervisor, так что я пошел этим путем. 

Минимальный конфиг файл для супервизора:

	[program:gearmand]
	command=/usr/sbin/gearmand -L 127.0.0.1 --user=gearman --log-file=stderr
	autorestart=true
	autostart=true

`-L 127.0.0.1` указано, во первых, что-бы gearman не биндился на внешние интерфейсы (там все закрыто фаирволом, но все же). Во вторых - если на машине включен ipv6, но не настроен, то gearman будет пытаться забиндиться и на ipv6 и падать.

З.Ы. инит для supervisord в 14.04 тоже кривой, но это уже другая история.
